ADR-001: Wordle tipo Å¾aidimas (React + Vite + Tailwind)

ID: ADR-001
Data: 2025-09-03
Sprendimo bÅ«sena: Patvirtinta
Autorius: Simonas

Tikslas

Sukurti Wordle tipo Å¾aidimÄ… lietuviÅ¡kai su aiÅ¡kiomis taisyklÄ—mis, informatyviais klaidÅ³ praneÅ¡imais ir geru testÅ³ padengimu. MVP orientuotas Ä¯ vieno Å¾aidÄ—jo patirtÄ¯ narÅ¡yklÄ—je.

Kontekstas

Naudojamos technologijos: React, Vite, Tailwind CSS, TypeScript, Vitest, (Playwright â€“ planuojama).

Reikia UI su taisykliÅ³ paaiÅ¡kinimu (modalas) ir informatyviais klaidÅ³ praneÅ¡imais (LT).

MVP: su lietuviÅ¡komis raidÄ—mis (Ä…, Ä, Ä™, Ä—, Ä¯, Å¡, Å³, Å«, Å¾); Å¾odÅ¾iÅ³ sÄ…raÅ¡as 100 Ä¯raÅ¡Å³ (tiksliai 5 raidÄ—s).

Sprendimas (architektÅ«ra ir technologijos)

Framework: React 19+ (naujausia stabilioji)

Bundler: Vite

Stilius: Tailwind CSS

Kalba: TypeScript

Testai: Vitest (unit), @testing-library/react (integraciniai), Playwright (E2E)

BÅ«senos valdymas: React hookâ€™ai (Context+reducer nereikalingas MVP)

Duomenys: localStorage (bÅ«senos iÅ¡saugojimas, su versijavimu/migracija)

Å½odynas:

- `solutions.json` â€“ lygiai 100 lietuviÅ¡kÅ³ 5 raidÅ¾iÅ³ Å¾odÅ¾iÅ³ (galimi dienos tikslai)
- `allowed.json` â€“ leidÅ¾iamÅ³ Ä¯vedimÅ³ sÄ…raÅ¡as (âŠ‡ solutions). Å iuo metu nustatytas toks pat kaip `solutions.json` (100/100) stabilumui.

MVP apimtis

5 raidÅ¾iÅ³ Å¾odis, 6 bandymai, tikslinis Å¾odis parenkamas atsitiktinai kiekvienam naujam Å¾aidimui

Lenta, klaviatÅ«ra (ekrano + fizinÄ—). EkraninÄ— klaviatÅ«ra: 3 bazinÄ—s eilutÄ—s kaip anksÄiau + atskira lietuviÅ¡kÅ³ diakritikÅ³ eilutÄ—.

TaisykliÅ³ modalas, LT klaidÅ³ praneÅ¡imai

LocalStorage iÅ¡saugojimas su schema versija

Prieinamumas (a11y): aria-live praneÅ¡imai, klaviatÅ«ros navigacija, spalvÅ³ alternatyvos

Unit + integraciniai testai

Domeno modelis

Tipai: Word, Guess, FeedbackCell, AttemptResult, GameState

Funkcijos: validateGuess, scoreGuess, isWin, pickDailyTarget (naudojama tik testams/regresijai), normalizeInput

GameState papildytas: epochDay, targetId, version (storage schema), wordlistVersion

TaisyklÄ—s (rodoma ir UI)

AtspÄ—k 5 raidÅ¾iÅ³ Å¾odÄ¯ per 6 bandymus.

Po bandymo: Å¾alia (teisinga vieta), geltona (yra Å¾odyje, kita vieta), pilka (nÄ—ra Å¾odyje).

LeidÅ¾iami tik 5 raidÅ¾iÅ³ Å¾odÅ¾iai iÅ¡ leidÅ¾iamo sÄ…raÅ¡o (allowed.json).

LeidÅ¾iamos LT raidÄ—s su diakritikomis (Ä¯vestis iÅ¡saugoma nekeiÄiant diakritikÅ³). Ä®vestis:
- Fizinis klaviatÅ«ros Ä¯vedimas â€“ regex `^[a-zÄ…ÄÄ™Ä—Ä¯Å¡Å³Å«Å¾]$` (didÅ¾iosios/maÅ¾osios) (`src/App.tsx`).
- EkraninÄ— klaviatÅ«ra â€“ papildoma LT eilutÄ— (`src/components/Keyboard.tsx`).

KlaidÅ³ praneÅ¡imai (pavyzdÅ¾iai)

â€Å½odis per trumpas (4/5). Ä®vesk 5 raidÅ¾iÅ³ Å¾odÄ¯.â€œ

â€Å½odyne nÄ—ra: "xxxxx". Pasirink kitÄ… 5 raidÅ¾iÅ³ Å¾odÄ¯.â€œ

â€BandymÅ³ nebeliko. Teisingas Å¾odis: XXXXX. Paspausk â€Naujas Å¾aidimasâ€œ.â€œ

â€LeidÅ¾iami tik raidiniai simboliai Aâ€“Å½.â€œ

Tikslinio Å¾odÅ¾io parinkimas

Numatytai parenkamas atsitiktinai kiekvienam naujam Å¾aidimui.

Istorinis/deterministinis parinkimas pagal dienÄ… (`pickDailyTarget`) paliekamas kode testams ir regresijai, bet UI naudoja atsitiktinÄ¯ (`emptyState()` kvieÄia `pickRandomTarget()`).

`wordlistVersion` vis dar saugoma bÅ«senos schemoje, kad ateityje keiÄiant Å¾odynÄ… bÅ«tÅ³ galima valdyti migracijas.

Papildomos funkcijos (artimiausias prioritetas)

1) Dalinimasis rezultatais

- UX: po pergalÄ—s/pralaimÄ—jimo rodomas mygtukas â€Kopijuoti rezultatÄ…â€œ. Formatas: 5x6 emoji tinklelis (ğŸŸ©/ğŸŸ¨/â¬›) be spoileriÅ³ + data/epochDay + nuoroda Ä¯ Å¾aidimÄ….
- Ä®gyvendinimas: util funkcija, kuri iÅ¡ `attempts`/`feedback` suformuoja tekstÄ…; `navigator.clipboard.writeText` su fallback.
- A11y: `aria-live` praneÅ¡imas â€Nukopijuota Ä¯ iÅ¡karpinÄ™â€œ.

3) ESC uÅ¾daro modalius

- UX/A11y: paspaudus Escape, turi uÅ¾sidaryti atidarytas modalas (Rules/Stats ir pan.).
- Ä®gyvendinimas: `useEffect` su `keydown` listeneriu modaliuose; uÅ¾tikrinti `aria-modal` ir focus grÄ…Å¾inimÄ….

4) Hard Mode

- UX: perjungiklis â€Hardâ€œ antraÅ¡tÄ—je. Ä®jungus â€“ privaloma naudoti anksÄiau atskleistas uÅ¾uominas: Å¾alios raidÄ—s turi likti tose paÄiose pozicijose, geltonos â€“ privalo bÅ«ti Å¾odyje; taip pat Ä¯sijungia perâ€‘spÄ—jimo laikmatis.
- Ä®gyvendinimas: prieÅ¡ `validateGuess()` â€“ papildomas patikrinimas pagal ankstesnius bandymus. Klaidos praneÅ¡imai LT. Laikmatis startuoja su pirmu Ä¯vedimu ir, jam pasibaigus, automatiÅ¡kai prarandamas bandymas.

5) Konfeti/pergaliÅ³ fejerverkai

- UX: laimÄ—jus â€“ trumpa konfeti animacija (2.5s), neveikia sÄ…veikai (pointer-events none).
- Ä®gyvendinimas: `Confetti` `<canvas>` komponentas, kuris veikia renderinant > automatiÅ¡kai iÅ¡sijungia.

6) Mini kalendorius statistikoje

- UX: statistikos modale rodoma paskutiniÅ³ ~30 dienÅ³ rezultatai kaip maÅ¾Å³ kvadratÄ—liÅ³ tinklelis (Å¾alia/pralaimÄ—ta raudona/neÅ¾aista pilka).
- Ä®gyvendinimas: naudojamas `resultsByDay` iÅ¡ `localStorage.stats`. Jei trÅ«ksta datÅ³ â€“ vizualizuojamas artimiausias periodas pagal turimus raktus.

7) ApatinÄ— veiksmÅ³ juosta (Rules/Stats) visose rezoliucijose

- UX: â€ğŸ“Š Statistikaâ€œ ir â€ğŸ“œ TaisyklÄ—sâ€œ yra nuolat pasiekiami sticky apatinÄ—je juostoje virÅ¡ klaviatÅ«ros/apaÄios kraÅ¡to, tiek mobiliuose, tiek desktopâ€™uose. AntraÅ¡tÄ—je mygtukÅ³ nebÄ—ra (virÅ¡uje liko â€Naujas Å¾aidimasâ€œ ir â€âš¡ Sunkuâ€œ).
- Ä®gyvendinimas: juosta su `sticky bottom-0`, pusiau permatomu fonu (`bg-gray-900/70`), `backdrop-blur`, subtilus `border-t` ir `env(safe-area-inset-bottom)` padding. EiliÅ¡kumas: pirmiausia `ğŸ“Š Statistika`, po to `ğŸ“œ TaisyklÄ—s`.

IkonÅ³ politika

- Principai: naudoti paprastas, semantiÅ¡kas emoji piktogramas tekstui sustiprinti, bet ne pakeisti. Pvz.: `ğŸ“Š Statistika`, `ğŸ“œ TaisyklÄ—s`, `âš¡ Sunku`.
- Prieinamumas: tekstas visada lieka; ikonÅ³ buvimas nekeiÄia reikÅ¡mÄ—s. Atributai `aria-pressed`, `aria-label` naudojami bÅ«senoms.

Testavimo strategija

StruktÅ«ra: visi testai laikomi `src/__tests__/` (unit, component, integration) dÄ—l stabilumo ir aiÅ¡kumo.

Unit (Vitest): validateGuess, scoreGuess (dvigubos raidÄ—s), pickDailyTarget, normalizeInput, baseEpochDay; storage serijÅ³ logika ir guardâ€™ai.

Component: Board (eiluÄiÅ³/plyteliÅ³ atvaizdavimas, animacijÅ³ klasÄ—s), StatsModal (KPI, uÅ¾darymas su Escape/overlay).

Integraciniai (RTL): App â€“ Ä¯vedimas per ekraninÄ™ klaviatÅ«rÄ…, klaidÅ³ praneÅ¡imai, laimÄ—jimo srautas ir â€geriausio laikoâ€œ (best time) persistencija po â€Naujas Å¾aidimasâ€œ.

Aplinka: `vitest.setup.ts` pateikia `requestAnimationFrame` ir `HTMLCanvasElement.getContext` maketus; Confetti testuose â€“ no-op mock, kad iÅ¡vengtume jsdom canvas apribojimÅ³.

Testavimo pastabos ir sprendimai
---------------------------------

- `StatsModal` komponentui pridÄ—tas pasirenkamas `animationDuration` props (numatytai 700 ms).
- Determinizmui KPI testuose naudojame strategijas:
  - `animationDuration={0}` â€“ reikÅ¡mÄ—s atnaujinamos iÅ¡kart (be tarpiniÅ³ kadrÅ³).
  - RAF kelias (baigimas per pirmÄ… kadrÄ…) â€“ `requestAnimationFrame` stubâ€™inamas taip, kad pirmame kvietime perduotume didelÄ¯ laikÄ… ir animacija baigtÅ³si (p=1), leidÅ¾ia patikrinti count-up be `useFakeTimers`.
  - RAF kelias (tÄ™sinys) â€“ papildomas testas, kuris pirmame kvietime perduoda `t=0` (p<1), todÄ—l suplanuojamas antras kadras; antrame kvietime `t>duration` uÅ¾baigia animacijÄ… (padengia p<1 Å¡akÄ…).
- Lokalizacijos tarpas tarp skaiÄiaus ir `%` (pvz., `75 %`) tikrinamas regex su pasirenkamu tarpu: `/75\s*%/`.
- `navigator.vibrate` jsdomâ€™e nÄ—ra â€“ testuose Ä¯dedamas stabilus stubâ€™as: `Object.defineProperty(navigator, 'vibrate', { value: vi.fn(), configurable: true, writable: true })` ir tik tada spyOn.
- React 19 dev perspÄ—jimas â€Expected static flag was missingâ€œ nutildomas `vitest.setup.ts` per `console.error` spy, paliekant kitus errorâ€™us.
- `StatsModal` KPI gridâ€™as semantiÅ¡kai apgaubtas `role="group" aria-label="KPI"`, kad testai galÄ—tÅ³ siaurinti paieÅ¡kÄ… ir iÅ¡vengti dviprasmybiÅ³.
- Mini kalendoriaus testas izoliuojamas: prieÅ¡ importÄ… resetinam modulius ir mockinam `loadStats()` su `resultsByDay` pagal `baseEpochDay()` (pvz., `{ [today]: 'win', [today-1]: 'loss' }`), kad visos bÅ«senos tikrai patektÅ³ Ä¯ matomÄ… 5 savaiÄiÅ³ langÄ….

Padengimas: 100% politika
-------------------------

- GlobalÅ«s slenksÄiai `vitest.config.ts`: `lines:100`, `statements:100`, `functions:100`, `branches:100`.
- Hard Mode ir laikmaÄio testai: validacija (Å¾alios/geltonos/raidÅ¾iÅ³ kiekiai), laiko pabaigos srautas (prarastas bandymas), laikmaÄio nerodymas ir nestartavimas, kai Hard Mode iÅ¡jungtas.
- Papildomi testai pridengia likusias Å¡akas: `AnimatedNumber` momentinis kelias (`duration=0`), RAF tÄ™simo Å¡aka (kai `p<1` suplanuojamas kitas kadras), ir bandymÅ³ pasiskirstymo juostÅ³ ploÄiÅ³ skaiÄiavimas tiek kai `wins>0 && maxAttempts>0`, tiek fallback atveju.
- Histogramos ploÄio skaiÄiavimas supaprastintas paÅ¡alinant nepasiekiamÄ… Å¡akÄ…: `maxAttempts` visada â‰¥1 (iÅ¡vedamas su `Math.max(1, ...)`), todÄ—l pakanka `Math.max(6, round(v/maxAttempts*100))`.

PriÄ—mimo kriterijai

Å½aidimas pagal taisykles (5x6), taisyklÄ—s matomos, klaidos LT, veikia ekrano ir fizinÄ— klaviatÅ«ra, iÅ¡saugo bÅ«senÄ…, testai praeina, UI responsyvus, spalvos turi alternatyvÄ… neregintiems. Tikslinis Å¾odis atsitiktinis naujam Å¾aidimui; laikmatis taikomas tik Hard Mode.

UI animacijos ir UX sprendimai
------------------------------

- KlaviatÅ«ros paspaudimas: CSS ripple + subtilus scale (`.key-btn`).
- Statistikos modalas:
  - Atidarymas â€“ overlay fade-in ir kortelÄ—s scale+slide in (CSS `modal-overlay`, `modal-card`).
  - UÅ¾darymas â€“ laikinai momentinis (be outro), kad iÅ¡vengtume uÅ¾strigimÅ³ (overlay be kortelÄ—s). Outro sugrÄ…Å¾insime valdant `animationend` vietoj `setTimeout`.
- Histogramos juostos: plotis auga per `transition`.
- Hard Mode mygtukas: subtilus pulsavimas (`.btn-pulse`).
- KPI skaitikliai: sklandus count-up su `requestAnimationFrame` ir ease-out.
- ApatinÄ— juosta: sustiprintas `backdrop-blur-md` ir `shadow-lg` dÄ—l vizualios hierarchijos.

A11y ir naÅ¡umas
----------------

- Modalai su `aria-modal`, Escape uÅ¾darymu, fokusas nukreipiamas Ä¯ â€UÅ¾darytiâ€œ.
- KPI skaitikliai turi `aria-live="polite"`.
- `prefers-reduced-motion`: sumaÅ¾iname animacijÅ³ trukmÄ™ ir iÅ¡jungiame nereikalingas perÄ—jimo animacijas.
- Animacijos remiasi `transform/opacity` ir `will-change` (GPU-draugiÅ¡ka), vengiam layout thrash.

PakeitimÅ³ istorija (trumpai)
----------------------------

- 2025-09-04: IÅ¡jungtas statistikos modalo uÅ¾darymo (outro) animavimas dÄ—l stabilumo; paliktas tik atidarymo (intro) efektas. Z-index pakeltas overlay/kortelei.
- 2025-09-04: Patobulintos plyteliÅ³ `flip-in`/`pop-in` animacijos (perspective, overshoot), pridÄ—tas `prefers-reduced-motion`.
- 2025-09-04: Sustiprintas apatinÄ—s juostos `backdrop-blur` ir `shadow`.
- 2025-09-04: `StatsModal` gavo `animationDuration` prop; testuose naudojamas tiek `animationDuration={0}`, tiek RAF stubâ€™as greitam uÅ¾baigimui.
- 2025-09-04: Testuose pridÄ—tas stabilus `navigator.vibrate` stubâ€™as; nutildytas React 19 perspÄ—jimas â€Expected static flag was missingâ€œ setupâ€™e.
- 2025-09-04: KPI gridâ€™ui pridÄ—tas `role="group" aria-label="KPI"`; mini kalendoriaus testas padarytas deterministinis naudojant `baseEpochDay()`.
- 2025-09-04: Coverage slenksÄiai `vitest.config.ts` pakelti iki 100/100/100/100; pridÄ—ti testai, dengiantys likusias Å¡akas (Ä¯sk. RAF `p<1` tÄ™stinÄ™ Å¡akÄ…).
- 2025-09-04: Pakeista Å¾odÅ¾io parinkimo strategija Ä¯ atsitiktinÄ™; perâ€‘spÄ—jimo laikmatis Ä¯jungiamas tik Hard Mode (UI/UX ir testÅ³ atnaujinimai).
- 2025-09-04: PridÄ—tas **leaderboard** funkcionalumas: vardo Ä¯vedimo modalas laimÄ—jus (`WinNameModal`), lyderiÅ³ lentelÄ— statistikos modale su top 10 rezultatÅ³, localStorage saugojimas su `saveLeaderboardEntry` ir `loadLeaderboard` funkcijomis. Testai papildyti leaderboard scenarijais.
- 2025-09-04: `StatsModal` histogramos ploÄio formulÄ— supaprastinta, paÅ¡alinta nepasiekiama Å¡aka; `AnimatedNumber` RAF planavimas paliktas su sÄ…lyga `p<1` (iÅ¡vengiant begalinio ciklo), padengta testais.